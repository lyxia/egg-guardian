name = "egg-guardian-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# D1 数据库绑定
[[d1_databases]]
binding = "DB"
database_name = "egg-guardian-db"
# database_id will be set by GitHub Actions workflow after database creation

# 环境变量
[vars]
SSO_URL = "https://api.activing.fun"
ALLOWED_ORIGIN = "https://childrenlearn.activing.fun"
CALLBACK_URL = "https://childrenlearn.activing.fun/api/auth/callback"
# JWT_SECRET should be set using: wrangler secret put JWT_SECRET

# 生产环境配置
# IMPORTANT: Set JWT_SECRET using: wrangler secret put JWT_SECRET --env production
[env.production]
name = "egg-guardian-api"
vars = { SSO_URL = "https://api.activing.fun", ALLOWED_ORIGIN = "https://childrenlearn.activing.fun", CALLBACK_URL = "https://childrenlearn.activing.fun/api/auth/callback" }

[[env.production.d1_databases]]
binding = "DB"
database_name = "egg-guardian-db"
database_id = "placeholder"  # Will be replaced by GitHub Actions workflow during deployment

# 开发环境配置
[env.development]
name = "egg-guardian-api-dev"

[[env.development.d1_databases]]
binding = "DB"
database_name = "egg-guardian-db"
database_id = "1c17aa9f-90bf-4e6b-a650-0360519a42c1"

[env.development.vars]
SSO_URL = "http://localhost:8791"
ALLOWED_ORIGIN = "https://childrenlearn.activing.fun"
CALLBACK_URL = "https://childrenlearn.activing.fun/api/auth/callback"
# JWT_SECRET for dev can be set via wrangler secret or use a dev default
